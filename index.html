<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Encontro UP | Construindo Uma Vida Mais Leve</title>
  <meta name="description" content="Inscreva-se na aula gratuita de Inteligência Emocional com dinâmica de alto impacto e exercício guiado para controlar a ansiedade. Conduzida por Rodrigo Damaceno. 86% das vagas preenchidas." />
    <!-- Favicons / App Icons -->
    <link rel="icon" href="/img/up.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/img/up.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/img/up.png" />
    <link rel="shortcut icon" href="/img/up.png" />
    <link rel="apple-touch-icon" href="/img/up.png" />
    <meta name="theme-color" content="#0a0a14" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --primary:#27abb6;             /* cor institucional principal */
        --primary-rgb:39,171,182;
        --bg:#000000;                  /* fundo principal preto */
        --bg2:#0e0e0e;                 /* variação de fundo */
        --text:#ffffff;                /* texto padrão */
        --muted:#d1d5d8;               /* texto secundário */
        --card:#101414;                /* cartões */
        --card-border:#1e2627;         /* borda sutil */
        --accent:#27abb6;              /* igual primary para consistência */
        --danger:#ff5656;
        --focus:#ffffff;
        --focus-ring:0 0 0 3px rgba(var(--primary-rgb), .55);
      }
      *{box-sizing:border-box;-webkit-font-smoothing:antialiased;}
      html{font-size:18px;} /* base maior para legibilidade */
      @media (max-width:900px){ html{font-size:17px;} }
      @media (max-width:600px){ html{font-size:16px;} }
      html,body{height:100%}
      body{
        margin:0; font-family: 'Montserrat', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
        color:var(--text);
        background:linear-gradient(145deg,#000000,#061112 55%, #082024);
        line-height:1.5;
      }
      .container{max-width:1100px; margin:0 auto; padding:24px}
      .hero{padding:40px 0 28px}
  .hero h1{margin:0 0 14px; font-size: clamp(2.15rem, 4.2vw, 3.1rem); color:var(--primary); line-height:1.1; letter-spacing:-.5px; text-shadow:0 3px 14px rgba(var(--primary-rgb),.28)}
  .hero h1.hero-title{color:var(--primary);} /* manter primário como base */
  .hero-title .t-white{color:#ffffff;}
  .hero-title .t-accent{color:var(--primary);}
  .hero p{margin:0 0 22px; color:var(--muted); font-size: clamp(1rem, 1.6vw, 1.25rem); max-width:860px}
      .layout{display:grid; grid-template-columns: 1.2fr 1fr; gap:22px; align-items:start}
      @media (max-width: 960px){ .layout{grid-template-columns: 1fr} }

  /* Lista de pontos no hero */
  .hero-points{list-style:none; margin:0 0 24px; padding:0; display:grid; gap:10px; max-width:640px}
  .hero-points li{background:#0f1819; border:1px solid #1f3335; padding:12px 16px; border-radius:14px; font-size:.95rem; font-weight:500; letter-spacing:.3px; line-height:1.35; position:relative}
  .hero-points li:before{content:'+'; position:absolute; left:12px; top:50%; transform:translateY(-50%); background:linear-gradient(135deg,rgba(var(--primary-rgb),.2),rgba(var(--primary-rgb),.05)); width:26px; height:26px; display:flex; align-items:center; justify-content:center; border-radius:8px; font-weight:800; color:var(--primary); border:1px solid #224c50; box-shadow:0 0 0 1px #173538 inset}
  .hero-points li{padding-left:50px}

      /* Card Form */
  .card{background:var(--card); border:1px solid var(--card-border); border-radius:22px; padding:28px 26px 34px; box-shadow:0 8px 40px -6px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.03); position:relative; overflow:hidden}
  .card:before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(circle at 88% 12%,rgba(var(--primary-rgb),.22),transparent 60%)}
      .form-header{display:flex; gap:10px; justify-content:center; margin:4px 0 18px; flex-wrap:wrap}
      .dot{width:34px; height:34px; border-radius:50%; background:#151b1c; color:#7fa6aa; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:.85rem; border:2px solid #223235; transition:.25s}
      .dot.active{background:var(--primary); color:#001c20; border-color:var(--primary); box-shadow:0 0 0 4px rgba(var(--primary-rgb),.35)}
      .dot.done{background:#1e7e86; color:#d5f7fa; border-color:#1e7e86; opacity:.85}
      .form-step{display:none}
      .form-step.active{display:block}
      .field{display:flex; flex-direction:column; gap:8px; margin-bottom:18px}
      .field label{font-size:1rem; color:var(--text); font-weight:600; letter-spacing:.3px}
      .field input,.field textarea,.field select{background:#0b1213; color:var(--text); border:2px solid #1c2a2c; border-radius:14px; padding:15px 16px; outline:none; font-size:1rem; line-height:1.3; font-weight:500; transition:.25s}
      .field input:focus,.field textarea:focus,.field select:focus{border-color:var(--primary); box-shadow:var(--focus-ring)}
      .field input::placeholder{color:#6d7e80; font-weight:400}
      .error{color:var(--danger); font-size:.75rem; min-height:18px; letter-spacing:.4px}
      .actions{display:flex; justify-content:space-between; gap:12px; margin-top:8px}
      .btn{appearance:none; border:2px solid #204145; background:#112426; color:var(--text); padding:15px 22px; border-radius:14px; cursor:pointer; font-weight:700; letter-spacing:.5px; font-size:1rem; display:inline-flex; align-items:center; gap:6px; transition:.25s}
      .btn:hover{background:#183237; border-color:#2d5f65}
      .btn:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(var(--primary-rgb),.55)}
      .btn-primary{background:var(--primary); border-color:var(--primary); color:#002b30; text-shadow:0 1px 0 rgba(255,255,255,.25)}
      .btn-primary:hover{background:#1e919b; border-color:#1e919b; color:#e6feff}
      .note{color:var(--muted); font-size:.7rem; margin-top:6px; letter-spacing:.5px}

      /* Benefits */
      .section{padding:28px 0}
  .section h2{color:var(--primary); margin:0 0 14px; font-size: clamp(1.55rem, 2.9vw, 2.15rem); letter-spacing:.5px}
      .benefits{display:grid; gap:10px; margin:0; padding:0; list-style:none}
  .benefits li{display:flex; align-items:flex-start; gap:14px; padding:16px 18px; background:#0f1819; border:1px solid #1f3335; border-radius:16px; line-height:1.42; font-size:.95rem}
      .check{color:#22e386; font-weight:700}
      .cta-wrap{margin-top:16px}
  .cta{appearance:none; background:var(--primary); color:#002b30; border:2px solid var(--primary); padding:18px 26px; border-radius:16px; font-weight:800; cursor:pointer; font-size:1.05rem; letter-spacing:.6px; box-shadow:0 6px 18px -4px rgba(var(--primary-rgb),.45)}
  .cta:hover{background:#1e919b; border-color:#1e919b; color:#e9feff}
    /* Nova lista de tópicos de transformação */
    .transform-list{display:grid; gap:14px; margin:0; padding:0; list-style:none;}
    .transform-item{position:relative; padding:18px 20px 18px 56px; background:#0f1819; border:1px solid #1f3335; border-radius:18px; font-size:1rem; font-weight:600; letter-spacing:.3px; line-height:1.35;}
    .transform-item:before{content:""; position:absolute; left:18px; top:50%; width:26px; height:26px; border-radius:8px; background:linear-gradient(135deg, rgba(var(--primary-rgb),.15), rgba(var(--primary-rgb),.05)); border:1px solid #225055; transform:translateY(-50%); box-shadow:0 0 0 1px #193a3d inset, 0 4px 10px -4px rgba(0,0,0,.6);}
    .transform-item:after{content:"+"; position:absolute; left:26px; top:50%; transform:translate(-50%,-50%); font-weight:800; color:var(--primary); font-size:1.05rem; text-shadow:0 0 6px rgba(var(--primary-rgb),.55);}
    .transform-accent{color:var(--primary); font-weight:700;}

      /* Mentor */
      .mentor{display:grid; grid-template-columns: 1fr 1.2fr; gap:18px; align-items:center}
      @media (max-width: 960px){ .mentor{grid-template-columns:1fr} }
  .mentor img{width:100%; height:auto; border-radius:16px; border:2px solid #1e3336; box-shadow:0 8px 26px -6px rgba(0,0,0,.6)}
  .mentor h3{margin:8px 0 4px; color:var(--primary); font-weight:700; font-size:1.25rem; letter-spacing:.5px}

  .scarcity{background:#0f1819;border:1px solid #1e3335;padding:14px 18px;border-radius:18px;margin-bottom:18px;display:flex;flex-direction:column;gap:8px}
  .scarcity strong{color:#ffe1a4}
  .scarcity-progress{height:12px;background:#0b1314;border:1px solid #1f3032;border-radius:24px;overflow:hidden;position:relative}
  .scarcity-progress span{display:block;height:100%;background:linear-gradient(90deg,#27abb6,#6edbe4);width:86%;position:relative;box-shadow:0 0 0 1px #1a3d41,0 0 16px -2px rgba(var(--primary-rgb),.55)}
  .tag-live{display:inline-block;background:#ff4d4d;color:#fff;font-size:.6rem;font-weight:700;padding:5px 10px;border-radius:30px;letter-spacing:.6px;box-shadow:0 0 0 1px #ff6565;margin-right:6px}
  .mini-deadline{font-size:.62rem;color:#94b4b8;letter-spacing:.6px;text-transform:uppercase}
  .cta-ribbon{background:#183437;color:#9ff6fc;font-size:.62rem;font-weight:600;padding:6px 12px;border:1px solid #205055;border-radius:40px;display:inline-flex;align-items:center;gap:6px;box-shadow:0 0 0 1px #205055 inset;letter-spacing:.7px}
  footer{color:var(--muted); font-size:.7rem; padding:24px 0 48px; letter-spacing:.5px}
      /* Ajustar radios e checkboxes maiores */
      input[type=radio],input[type=checkbox]{width:20px;height:20px;cursor:pointer; accent-color: var(--primary);}
      label>input[type=radio],label>input[type=checkbox]{margin-right:6px; transform:translateY(1px);}
      /* Aumentar espaçamento entre opções de grupos */
      .form-step label input[type=radio]+span,.form-step label input[type=checkbox]+span{font-size:1rem;}
      .form-step label{font-size:.95rem; font-weight:500;}
      /* Barra de status mais legível */
      #sendStatus{font-size:.8rem !important; letter-spacing:.4px}
    </style>
  </head>
  <body>
    <header class="hero">
      <div class="container">
        <div class="layout">
          <div>
            <h1 class="hero-title"><span class="t-accent">Encontro UP</span> | <span class="t-white">Construindo Uma Vida Mais Leve</span></h1>
            <ul class="hero-points" aria-label="Benefícios principais">
              <li><strong>menos ansiedade</strong> ... mais foco</li>
              <li><strong>menos estresse</strong> ... mais qualidade de sono</li>
              <li>mais comunicação <strong>assertiva</strong></li>
              <li>mais relacionamentos <strong>saudáveis</strong></li>
              <li>mais saúde <strong>física e emocional</strong></li>
            </ul>
            <div class="scarcity" aria-label="Indicador de vagas restantes">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
                <div style="font-size:13px;font-weight:600;color:#cfd2ff;">86% das vagas preenchidas</div>
                <div class="cta-ribbon">Vagas Limitadas</div>
              </div>
              <div class="scarcity-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="86"><span></span></div>
              <div class="mini-deadline">Movimento alto hoje — confirme enquanto ainda há acesso.</div>
            </div>
          </div>
          <div>
            <div id="formCard" class="card">
              <div class="form-header" id="progressDots" aria-label="Progresso do formulário">
                <div class="dot" data-step="0">1</div>
                <div class="dot" data-step="1">2</div>
                <div class="dot" data-step="2">3</div>
                <div class="dot" data-step="3">4</div>
                <div class="dot" data-step="4">5</div>
                <div class="dot" data-step="5">6</div>
                <div class="dot" data-step="6">7</div>
                <div class="dot" data-step="7">8</div>
              </div>
              <div id="progressText" style="text-align:center;font-size:12px;color:#8aa0ff;margin:-4px 0 12px;">Etapa 1 de 8</div>

              <form id="msForm" novalidate>
                <!-- Etapa 1: Dados Pessoais -->
                <div class="form-step active" data-step="0">
                  <div class="field">
                    <label for="nome">Nome Completo</label>
                    <input id="nome" name="nome" type="text" placeholder="Seu nome completo" required />
                    <div class="error" data-for="nome"></div>
                  </div>
                  <div class="field">
                    <label for="cidade">Cidade</label>
                    <input id="cidade" name="cidade" type="text" placeholder="Sua cidade" required />
                    <div class="error" data-for="cidade"></div>
                  </div>
                  <div class="field">
                    <label for="telefone">Telefone</label>
                    <input id="telefone" name="telefone" type="tel" inputmode="tel" placeholder="(00) 00000-0000" required />
                    <div class="error" data-for="telefone"></div>
                  </div>
                  <div class="actions">
                    <span></span>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div> <!-- fim .actions etapa 1 -->
                </div> <!-- fim .form-step etapa 1 -->

                <!-- Etapa 2: Informações Adicionais -->
                <div class="form-step" data-step="1">
                  <div class="field">
                    <label for="idade">Idade</label>
                    <input id="idade" name="idade" type="number" min="0" max="120" placeholder="Sua idade" />
                  </div>
                  <div class="field">
                    <label for="profissao">Profissão</label>
                    <input id="profissao" name="profissao" type="text" placeholder="Ex.: Designer, Professor" />
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 3: Nível de Ansiedade -->
                <div class="form-step" data-step="2">
                  <div class="field">
                    <label>Como está seu nível de ansiedade?</label>
                    <label><input type="radio" name="ansiedade" value="Muito ansioso" required /> Muito ansioso</label>
                    <label><input type="radio" name="ansiedade" value="Ansioso" /> Ansioso</label>
                    <label><input type="radio" name="ansiedade" value="Controlado" /> Controlado</label>
                    <label><input type="radio" name="ansiedade" value="Pouco ansioso" /> Pouco ansioso</label>
                    <label><input type="radio" name="ansiedade" value="Não tenho ansiedade" /> Não tenho ansiedade</label>
                    <label><input type="radio" name="ansiedade" value="Não sei" /> Não sei</label>
                    <label><input type="radio" name="ansiedade" value="Não quero responder" /> Não quero responder</label>
                    <div class="error" data-for="ansiedade"></div>
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 4: Qualidade do Sono -->
                <div class="form-step" data-step="3">
                  <div class="field">
                    <label>Como está sua qualidade do sono?</label>
                    <label><input type="radio" name="sono" value="Muito Boa" required /> Muito Boa</label>
                    <label><input type="radio" name="sono" value="Boa" /> Boa</label>
                    <label><input type="radio" name="sono" value="Regular" /> Regular</label>
                    <label><input type="radio" name="sono" value="Ruim" /> Ruim</label>
                    <label><input type="radio" name="sono" value="Muito ruim" /> Muito ruim</label>
                    <label><input type="radio" name="sono" value="Não sei" /> Não sei</label>
                    <label><input type="radio" name="sono" value="Não quero responder" /> Não quero responder</label>
                    <div class="error" data-for="sono"></div>
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 5: Relacionamento Amoroso -->
                <div class="form-step" data-step="4">
                  <div class="field">
                    <label>Como está seu relacionamento amoroso?</label>
                    <label><input type="radio" name="relacionamento" value="Muito Bom" required /> Muito Bom</label>
                    <label><input type="radio" name="relacionamento" value="Bom" /> Bom</label>
                    <label><input type="radio" name="relacionamento" value="Regular" /> Regular</label>
                    <label><input type="radio" name="relacionamento" value="Ruim" /> Ruim</label>
                    <label><input type="radio" name="relacionamento" value="Muito ruim" /> Muito ruim</label>
                    <label><input type="radio" name="relacionamento" value="Não tenho" /> Não tenho</label>
                    <label><input type="radio" name="relacionamento" value="Não sei" /> Não sei</label>
                    <label><input type="radio" name="relacionamento" value="Não quero responder" /> Não quero responder</label>
                    <div class="error" data-for="relacionamento"></div>
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 6: Saúde Física -->
                <div class="form-step" data-step="5">
                  <div class="field">
                    <label>Como está sua saúde física?</label>
                    <label><input type="radio" name="saude_fisica" value="Muito Boa" required /> Muito Boa</label>
                    <label><input type="radio" name="saude_fisica" value="Boa" /> Boa</label>
                    <label><input type="radio" name="saude_fisica" value="Regular" /> Regular</label>
                    <label><input type="radio" name="saude_fisica" value="Ruim" /> Ruim</label>
                    <label><input type="radio" name="saude_fisica" value="Muito ruim" /> Muito ruim</label>
                    <label><input type="radio" name="saude_fisica" value="Não sei" /> Não sei</label>
                    <label><input type="radio" name="saude_fisica" value="Não quero responder" /> Não quero responder</label>
                    <div class="error" data-for="saude_fisica"></div>
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 7: Vida Financeira -->
                <div class="form-step" data-step="6">
                  <div class="field">
                    <label>Como está sua vida financeira?</label>
                    <label><input type="radio" name="vida_financeira" value="Muito Boa" required /> Muito Boa</label>
                    <label><input type="radio" name="vida_financeira" value="Boa" /> Boa</label>
                    <label><input type="radio" name="vida_financeira" value="Regular" /> Regular</label>
                    <label><input type="radio" name="vida_financeira" value="Ruim" /> Ruim</label>
                    <label><input type="radio" name="vida_financeira" value="Muito ruim" /> Muito ruim</label>
                    <label><input type="radio" name="vida_financeira" value="Não sei" /> Não sei</label>
                    <label><input type="radio" name="vida_financeira" value="Não quero responder" /> Não quero responder</label>
                    <div class="error" data-for="vida_financeira"></div>
                  </div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="button" class="btn btn-primary" data-next>PRÓXIMO</button>
                  </div>
                </div>

                <!-- Etapa 8: Áreas de Melhoria -->
                <div class="form-step" data-step="7">
                  <div class="field">
                    <label>Qual área você quer melhorar? (Marque quantas desejar)</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Relacionamento amoroso" data-required-group="areas_melhoria" /> Relacionamento amoroso</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Saúde emocional" data-required-group="areas_melhoria" /> Saúde emocional</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Saúde física" data-required-group="areas_melhoria" /> Saúde física</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Vida financeira" data-required-group="areas_melhoria" /> Vida financeira</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Todas as anteriores" data-required-group="areas_melhoria" /> Todas as anteriores</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Não sei" data-required-group="areas_melhoria" /> Não sei</label>
                    <label><input type="checkbox" name="areas_melhoria" value="Não quero responder" data-required-group="areas_melhoria" /> Não quero responder</label>
                    <div class="error" data-for="areas_melhoria"></div>
                  </div>
                  <div class="note">Finalize para enviar o registro final.</div>
                  <div class="actions">
                    <button type="button" class="btn" data-back>VOLTAR</button>
                    <button type="submit" class="btn btn-primary">FINALIZAR</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- seção de transformações removida conforme solicitação -->

      <section class="section">
        <div class="container mentor">
          <div>
            <img src="/img/rodrigo-damaceno.jpg" alt="Rodrigo Damaceno - Especialista em Inteligência Emocional" loading="lazy" />
          </div>
          <div>
            <h2>Quem conduz a experiência?</h2>
            <h3>Rodrigo Damaceno</h3>
            <p>Especialista em inteligência emocional e treinamento comportamental, Rodrigo ajuda as pessoas a reconhecerem padrões reativos, reorganizar seu estado interno e aplicar técnicas eficazes de regulação emocional em situações de pressão. Nesta aula prática, você não apenas aprenderá teoria, mas também experimentará mudanças fisiológicas reais e sairá com uma ferramenta prática para gerenciar a ansiedade em momentos desafiadores.</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <small>Esta inscrição é exclusiva para a aula gratuita. Não há oferta de outro produto nesta página.</small>
      </div>
    </footer>

    <script>
      // =============================================
      // Configurações & Opções Avançadas
      // =============================================
      // Cole aqui a URL do seu Webhook do n8n (ex.: https://seu-n8n.tld/webhook/abcd-1234)
      // IMPORTANTE: enquanto estiver em modo "Listen" no n8n use a URL com /webhook-test/
      const N8N_WEBHOOK_URL = 'https://up-n8n.welzbd.easypanel.host/webhook-test/02c9ee4e-33d0-41d8-a4bc-0c1ed88dfe84';
      // Você também pode passar ?endpoint=https://... na URL da página para testar sem editar o arquivo.
      // URL de redirecionamento opcional após sucesso (deixe vazio se não quiser redirecionar)
      const REDIRECT_URL = '';// ex: 'https://seusite.com/obrigado'
      // Tempo (ms) antes de redirecionar automaticamente (se REDIRECT_URL não for vazio)
      const REDIRECT_DELAY = 3200;

      // Campos esperados para padronizar o payload (ordem e existência estável)
      const EXPECTED_FIELDS = [
        'nome','cidade','telefone','idade','profissao',
        'ansiedade','sono','relacionamento','saude_fisica','vida_financeira','areas_melhoria'
      ];
      // Se true: quando usuário apaga conteúdo de um campo texto/number, enviamos null (limpa no acumulado)
      // Se false: ignoramos campo vazio e preservamos valor anterior já capturado
      const NULLIFY_ON_EMPTY = false;

      // Captura UTMs & origem / primeira visita
      const utmData = (function(){
        const p = new URLSearchParams(location.search);
        const obj = {};
        ['utm_source','utm_medium','utm_campaign','utm_term','utm_content'].forEach(k=>{ if(p.get(k)) obj[k]=p.get(k); });
        if(document.referrer) obj.referrer = document.referrer;
        obj.landing_first_visit = (function(){
          try{
            const k='lp:firstVisit';
            let v=localStorage.getItem(k);
            if(!v){ v=new Date().toISOString(); localStorage.setItem(k,v);} return v;
          }catch{return new Date().toISOString();}
        })();
        return obj;
      })();
      function getEndpoint(){
        const u = new URL(location.href);
        const p = u.searchParams.get('endpoint');
        if(p && p.trim()) return p.trim();
        // Se estiver em domínio Vercel e N8N_WEBHOOK_URL não foi alterada manualmente, usa proxy serverless
        const host = location.hostname;
        const isVercel = host.endsWith('.vercel.app');
        if(isVercel){
          return '/api/n8n-proxy';
        }
        return N8N_WEBHOOK_URL;
      }

      const form = document.getElementById('msForm');
      const steps = Array.from(document.querySelectorAll('.form-step'));
      const dots = Array.from(document.querySelectorAll('#progressDots .dot'));
      const formCard = document.getElementById('formCard');
      // (Contagem regressiva removida a pedido)
      // Adiciona elemento de status
      let sendStatus = document.getElementById('sendStatus');
      if(!sendStatus){
        sendStatus = document.createElement('div');
        sendStatus.id = 'sendStatus';
        sendStatus.style.cssText = 'margin:8px 0 2px;font-size:12px;color:#8aa0ff;min-height:16px;';
        formCard.insertBefore(sendStatus, formCard.firstChild.nextSibling);
      }

  let current = 0;
  // Novo clientId a cada carregamento (permite múltiplas inscrições no mesmo dispositivo)
  let clientId = cryptoRandomId();
  const allData = {}; // acumulador

  // Máscara de telefone dinâmica (formato brasileiro)
  (function(){
    const telInput = document.getElementById('telefone');
    if(!telInput) return;
    telInput.addEventListener('input', ()=>{
      const digits = telInput.value.replace(/\D+/g,'').slice(0,11);
      let out = digits;
      if(digits.length > 10){
        out = `(${digits.slice(0,2)}) ${digits.slice(2,7)}-${digits.slice(7)}`;
      } else if(digits.length > 6){
        out = `(${digits.slice(0,2)}) ${digits.slice(2,6)}-${digits.slice(6)}`;
      } else if(digits.length > 2){
        out = `(${digits.slice(0,2)}) ${digits.slice(2)}`;
      } else if(digits.length > 0){
        out = '('+digits;
      }
      telInput.value = out;
    });
  })();

      function showStep(n){
        current = Math.max(0, Math.min(steps.length-1, n));
        steps.forEach((el, idx)=>{
          el.classList.toggle('active', idx === current);
        });
        dots.forEach((d, idx)=>{
          d.classList.remove('active','done');
          if(idx < current) d.classList.add('done');
          if(idx === current) d.classList.add('active');
        });
        const pt = document.getElementById('progressText');
        if(pt) pt.textContent = `Etapa ${current+1} de ${steps.length}`;
      }

      // Validação da etapa atual
      function validateCurrent(){
        const section = steps[current];
        if(!section) return true;
        let valid = true;
        // Limpa mensagens antigas
        section.querySelectorAll('.error').forEach(el=> el.textContent='');
        // Agrupar radios por name para checar uma vez
        const radiosChecked = new Set();
        // Checkboxes agrupados por data-required-group
        const requiredGroups = {};
        const inputs = section.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
          const name = input.name || input.id;
          if(!name) return;
          const errorEl = section.querySelector(`.error[data-for="${name}"]`);

          // Campos de texto/number/email/tel/select com required
          if((input.tagName === 'INPUT' || input.tagName === 'TEXTAREA' || input.tagName === 'SELECT') && input.type !== 'radio' && input.type !== 'checkbox'){
            if(input.hasAttribute('required') && !input.value.trim()){
              if(errorEl) errorEl.textContent = 'Campo obrigatório';
              valid = false;
            }
          }

          // Radios: validar apenas uma vez por grupo (name)
          if(input.type === 'radio'){
            if(!radiosChecked.has(name)){
              radiosChecked.add(name);
              const group = section.querySelectorAll(`input[type=radio][name="${name}"]`);
              const oneChecked = Array.from(group).some(r=> r.checked);
              if(!oneChecked){
                if(errorEl) errorEl.textContent = 'Selecione uma opção';
                valid = false;
              }
            }
          }

          // Checkboxes pertencentes a um grupo obrigatório
          if(input.type === 'checkbox' && input.dataset.requiredGroup){
            const g = input.dataset.requiredGroup;
            if(!requiredGroups[g]) requiredGroups[g] = [];
            requiredGroups[g].push(input);
          }
        });

        // Validar grupos de checkbox marcados como obrigatórios (pelo menos 1)
        Object.entries(requiredGroups).forEach(([group, list])=>{
          const any = list.some(cb => cb.checked);
            if(!any){
              // Usa data-for com o mesmo nome do primeiro checkbox (name comum)
              const name = list[0].name || list[0].id;
              const errorEl = section.querySelector(`.error[data-for="${name}"]`) || section.querySelector(`.error[data-for="${group}"]`);
              if(errorEl) errorEl.textContent = 'Marque ao menos uma opção';
              valid = false;
            }
        });
        return valid;
      }

      function collectStepData(){
        const section = steps[current];
        const inputs = section.querySelectorAll('input, textarea, select');
        const stepData = {};
        const checkboxGroups = {};
        inputs.forEach(el => {
          const key = el.name || el.id;
          if(!key) return;
          if(el.type === 'radio'){
            if(el.checked) stepData[key] = el.value;
          } else if(el.type === 'checkbox'){
            if(!checkboxGroups[key]) checkboxGroups[key] = [];
            if(el.checked) checkboxGroups[key].push(el.value || true);
          } else {
            if(el.value === ''){
              if(NULLIFY_ON_EMPTY) stepData[key] = null; // só limpa se flag ativa
            } else {
              stepData[key] = el.value;
            }
          }
        });
        Object.entries(checkboxGroups).forEach(([k,v])=>{ stepData[k] = v; });
        // Mescla (limpeza com null também sobrescreve)
        Object.entries(stepData).forEach(([k,v])=>{ allData[k] = v; });
        // Normaliza payload completo
        const payload = {};
        EXPECTED_FIELDS.forEach(f=>{
          if(f === 'areas_melhoria'){
            const val = allData[f];
            payload[f] = Array.isArray(val) ? val : (val == null ? [] : [val]);
          } else {
            payload[f] = (f in allData) ? allData[f] : null;
          }
        });
        // Metadados / tracking
        payload._step = current + 1;
        payload.clientId = clientId;
        payload.timestamp = new Date().toISOString();
        payload.page = location.href;
        Object.entries(utmData).forEach(([k,v])=>{ payload[k]=v; });
        return payload;
      }

      function setStatus(msg, type='info'){
        const colors = { info:'#8aa0ff', ok:'#74e39d', err:'#ff6b6b' };
        sendStatus.style.color = colors[type] || colors.info;
        sendStatus.textContent = msg || '';
      }

      async function sendPartial(data){
        // Envia os dados desta etapa ao seu backend
        // Troque a URL N8N_WEBHOOK_URL pela sua URL real (n8n). Ou use ?endpoint= na URL da página.
        try{
          const endpoint = getEndpoint();
          if(!endpoint || endpoint.startsWith('PASTE_')){
            console.warn('Defina a URL do Webhook do n8n em N8N_WEBHOOK_URL ou via ?endpoint=');
            setStatus('Webhook n8n não configurado', 'err');
            return;
          }
          setStatus('Enviando etapa ' + data._step + '...', 'info');
          const res = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if(!res.ok){
            const txt = await res.text().catch(()=>res.statusText);
            console.warn('Resposta não OK do n8n', res.status, txt);
            setStatus('Falha ('+res.status+') ao enviar etapa '+data._step, 'err');
          } else {
            setStatus('Etapa '+data._step+' salva ✔', 'ok');
          }
        }catch(err){
          // Se falhar, apenas registramos no console e seguimos.
          console.warn('Falha ao enviar etapa:', err);
          setStatus('Erro ao enviar etapa '+data._step, 'err');
        }
      }

      // Navegação Próximo/Voltar
      form.addEventListener('click', async (e)=>{
        const nextBtn = e.target.closest('[data-next]');
        const backBtn = e.target.closest('[data-back]');
        if(nextBtn){
          if(!validateCurrent()) { setStatus('Preencha os campos obrigatórios', 'err'); return; }
          const payload = collectStepData();
          await sendPartial(payload);
          showStep(current + 1);
        }
        if(backBtn){
          showStep(current - 1);
        }
      });

      // Envio final (poderia também disparar uma última captura)
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
  if(!validateCurrent()) { setStatus('Preencha os campos obrigatórios', 'err'); return; }
        const payload = collectStepData();
        payload._final = true;
        await sendPartial(payload);
        setStatus('Inscrição concluída, recarregando...', 'ok');
        setTimeout(()=> location.reload(), 600);
      });

      // (CTA removido conforme solicitação)

      // Inicializa
      showStep(0);

      // Modal de sucesso removido: usamos reload simples.


      function cryptoRandomId(){
        try{
          const arr = new Uint8Array(16);
          (self.crypto || window.crypto).getRandomValues(arr);
          return Array.from(arr).map(b=>b.toString(16).padStart(2,'0')).join('');
        }catch{
          return 'id-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
        }
      }

    </script>
  </body>
</html>
